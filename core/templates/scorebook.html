{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Scorebook{% endblock %}

{% block custom_css %}
    <style>
        div.scrollWrapper {
            height: 200px;
            width: 100%;
            overflow-y: scroll;
        }

        div.rosterScroll {
            height: 500px;
            width: 100%;
            overflow-y: scroll;
        }

        p {
            text-align: center;
            font-size: 60px;
            margin-top: 0px;
        }
    </style>
{% endblock custom_css %}

{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <h1 class="bg_black">Metadata</h1>
            </div>
            <div class="col-md-3">
                <h1 class="bg_black"><b>Game Timer</b><p id="countdown"></p></h1>
                <button id="startTimerButton" type="button" class="btn btn-success">
                    <span class="glyphicon glyphicon-play"></span>
                </button>
                <button id="stopTimerButton" type="button" class="btn btn-danger">
                    <span class="glyphicon glyphicon-pause"></span>
                </button>
                <button id="incrementTimer" type="button" class="btn btn-success">
                    <span class="glyphicon glyphicon-plus"></span>
                </button>
                <button id="decrementTimer" type="button" class="btn btn-danger">
                    <span class="glyphicon glyphicon-minus"></span>
                </button>
            </div>
            <div class="col-md-3">
                <h1 class="bg_black">
                    <button id="publishScorebookButton" type="button" class="btn btn-success btn-lg btn-block">Publish
                        Scorebook
                    </button>
                    <button id="clearScorebookButton" type="button" class="btn btn-danger btn-lg btn-block">&ensp;Clear
                        Scorebook&ensp;
                    </button>
                </h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h1 class="bg_black">
                    <b>Home Running Scores</b>
                    <button id="homeScoreButton" type="button" class="btn btn-success">Add Score</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Goal #</th>
                            <th>Assist #</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for score in scorebook.running_score.home.all %}
                            <tr>
                                <td>{{ score.time }}</td>
                                <td>{{ score.quarter }}</td>
                                <td>{{ score.goal_number }}</td>
                                <td>{{ score.assist_number }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-6">
                <h1 class="bg_black">
                    <b>Visiting Running Scores</b>
                    <button id="visitingScoreButton" type="button" class="btn btn-success">Add Score</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Goal #</th>
                            <th>Assist #</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for score in scorebook.running_score.visiting.all %}
                            <tr>
                                <td>{{ score.time }}</td>
                                <td>{{ score.quarter }}</td>
                                <td>{{ score.goal_number }}</td>
                                <td>{{ score.assist_number }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Penalties</b>
                    <span class="dropdown">
                        <button class="btn btn-danger dropdown-toggle" id="homeDropdownMenuButton" type="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Penalties
                        </button>
                        <div class="dropdown-menu" aria-labelledby=dropdownMenu1>
                            <li>
                                <button class="dropdown-item" id="homePersonalFoulButton" type="button">Personal Fowl
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="homeTechnicalFoulButton" type="button">Technical
                                    Fowl
                                </button>
                            </li>
                        </div>
                    </span>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>P/T</th>
                            <th>#</th>
                            <th>Infraction</th>
                            <th>Qtr</th>
                            <th>Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for penalty in scorebook.penalties.home.all %}
                            <tr>
                                {% if penalty.personal_foul == True %}
                                    <td>P</td>
                                {% else %}
                                    <td>T</td>
                                {% endif %}
                                <td>{{ penalty.player_number }}</td>
                                <td>{{ penalty.infraction }}</td>
                                <td>{{ penalty.quarter }}</td>
                                <td>{{ penalty.time }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>


            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Timeouts</b>
                    <button id="homeTimeoutButton" type="button" class="btn btn-primary">Call Timeout</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for timeout in scorebook.timeouts.home.all %}
                            <tr>
                                <td>{{ timeout.time }}</td>
                                <td>{{ timeout.quarter }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Penalties</b>
                    <span class="dropdown">
                        <button class="btn btn-danger dropdown-toggle" type="button" id="visitingDropdownMenuButton"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Penalize
                        </button>
                        <div class="dropdown-menu" aria-labelledby=dropdownMenu2>
                            <li>
                                <button class="dropdown-item" id="visitingPersonalFoulButton" type="button">Personal
                                    Fowl
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="visitingTechnicalFoulButton" type="button">Technical
                                    Fowl
                                </button>
                            </li>
                        </div>
                    </span>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>P/T</th>
                            <th>#</th>
                            <th>Infraction</th>
                            <th>Qtr</th>
                            <th>Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for penalty in scorebook.penalties.visiting.all %}
                            <tr>
                                {% if penalty.personal_foul == True %}
                                    <td>P</td>
                                {% else %}
                                    <td>T</td>
                                {% endif %}
                                <td>{{ penalty.player_number }}</td>
                                <td>{{ penalty.infraction }}</td>
                                <td>{{ penalty.quarter }}</td>
                                <td>{{ penalty.time }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Timeouts</b>
                    <button id="visitingTimeoutButton" type="button" class="btn btn-primary">Call Timeout</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for timeout in scorebook.timeouts.visiting.all %}
                            <tr>
                                <td>{{ timeout.time }}</td>
                                <td>{{ timeout.quarter }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h1 class="bg_black">
                    <b>Home Roster</b>
                    <button id="homeAddPlayerButton" type="button" class="btn btn-success">Add Player</button>
                    <button id="homeImportRosterButton" type="button" class="btn btn-primary">Import Roster</button>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Position</th>
                            <th>Name</th>
                            <th>Quarters</th>
                            <th>Shots</th>
                            <th>Goals</th>
                            <th>Assists</th>
                            <th>Ground Balls</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for player in scorebook.home_coach.roster.player_set.all %}
                            {# TODO: Update IDs for home/visiting roster checkboxes/text fields.#}
                            <tr>
                                <td>{{ player.player_number }}</td>
                                <td>{{ player.position }}</td>
                                <td>{{ player.last_name }}, {{ player.first_name }}</td>
                                <td>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterI{{ player.id }}">
                                            <label class="form-check-label" for="quarterI{{ player.id }}">I</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterII{{ player.id }}">
                                            <label class="form-check-label" for="quarterII{{ player.id }}">II</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIII{{ player.id }}">
                                            <label class="form-check-label" for="quarterIII{{ player.id }}">III</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIV{{ player.id }}">
                                            <label class="form-check-label" for="quarterIV{{ player.id }}">IV</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterOT{{ player.id }}">
                                            <label class="form-check-label" for="quarterOT{{ player.id }}">OT</label>
                                        </span>
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input1" placeholder="0">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input2" placeholder="0">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input3" placeholder="0">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input4" placeholder="0">
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h1 class="bg_black">
                    <b>Visiting Roster</b>
                    <button id="visitingAddPlayerButton" type="button" class="btn btn-success">Add Player</button>
                    <button id="visitingImportRosterButton" type="button" class="btn btn-primary">Import Roster</button>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Position</th>
                            <th>Name</th>
                            <th>Quarters</th>
                            <th>Shots</th>
                            <th>Goals</th>
                            <th>Assists</th>
                            <th>Ground Balls</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for player in scorebook.visiting_coach.roster.player_set.all %}
                            <tr>
                                <td>{{ player.player_number }}</td>
                                <td>{{ player.position }}</td>
                                <td>{{ player.last_name }}, {{ player.first_name }}</td>
                                <td>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterI{{ player.id }}">
                                            <label class="form-check-label" for="quarterI{{ player.id }}">I</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterII{{ player.id }}">
                                            <label class="form-check-label" for="quarterII{{ player.id }}">II</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIII{{ player.id }}">
                                            <label class="form-check-label" for="quarterIII{{ player.id }}">III</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIV{{ player.id }}">
                                            <label class="form-check-label" for="quarterIV{{ player.id }}">IV</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterOT{{ player.id }}">
                                            <label class="form-check-label" for="quarterOT{{ player.id }}">OT</label>
                                        </span>
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input1" placeholder="0">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input2" placeholder="0">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input3" placeholder="0">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="input4" placeholder="0">
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="publishScorebookModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Publish Scorebook</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {#            {{ form|crispy }}#}
                <input class="btn btn-primary btn-lg" type="submit" name="publishScorebookModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="publishScorebookModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="clearScorebookModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Clear Scorebook</h1>
            <form action="" method="POST">
                {% csrf_token %}
                <p>Are you sure you want to clear all changes?</p>
                <input class="btn btn-primary btn-lg" type="submit" name="clearScorebookModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="clearScorebookModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeScoreModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Score</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ running_score_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeScoreModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeScoreModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingScoreModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Score</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ running_score_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingScoreModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingScoreModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homePersonalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Personal Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ personal_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homePersonalFoulModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homePersonalFoulModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeTechnicalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Technical Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ technical_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTechnicalFoulModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTechnicalFoulModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingPersonalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Personal Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ personal_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingPersonalFoulModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingPersonalFoulModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingTechnicalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Technical Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ technical_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingTechnicalFoulModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingTechnicalFoulModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeTimeoutModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Call Timeout</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ timeout_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingTimeoutModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Call Timeout</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ timeout_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeAddPlayerModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ add_player_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeAddPlayerModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeAddPlayerModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingAddPlayerModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ add_player_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingAddPlayerModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingAddPlayerModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeImportRosterModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Import Roster</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ import_roster_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeImportRosterModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeImportRosterModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingImportRosterModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Import Roster</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ import_roster_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingImportRosterModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingImportRosterModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>


{% endblock %}

{% block custom_js %}
    <script type="text/javascript">

        /* Get publish/clear scorebook buttons. */
        let publishScorebookButton = document.getElementById("publishScorebookButton");
        let clearScorebookButton = document.getElementById("clearScorebookButton");

        /* Get running score buttons. */
        let homeScoreButton = document.getElementById("homeScoreButton");
        let visitingScoreButton = document.getElementById("visitingScoreButton");

        /* Get penalty buttons. */
        let homePersonalFoulButton = document.getElementById("homePersonalFoulButton");
        let homeTechnicalFoulButton = document.getElementById("homeTechnicalFoulButton");
        let visitingPersonalFoulButton = document.getElementById("visitingPersonalFoulButton");
        let visitingTechnicalFoulButton = document.getElementById("visitingTechnicalFoulButton");

        /* Get timeout buttons. */
        let homeTimeoutButton = document.getElementById("homeTimeoutButton");
        let visitingTimeoutButton = document.getElementById("visitingTimeoutButton");

        /* Get roster buttons. */
        let homeAddPlayerButton = document.getElementById("homeAddPlayerButton");
        let homeImportRosterButton = document.getElementById("homeImportRosterButton");
        let visitingAddPlayerButton = document.getElementById("visitingAddPlayerButton");
        let visitingImportRosterButton = document.getElementById("visitingImportRosterButton");

        /* Assign event handlers to all main view buttons to open corresponding modal. */
        let buttons = [
            publishScorebookButton, clearScorebookButton,
            homeScoreButton, visitingScoreButton,
            homePersonalFoulButton, homeTechnicalFoulButton,
            visitingPersonalFoulButton, visitingTechnicalFoulButton,
            homeTimeoutButton, visitingTimeoutButton,
            homeAddPlayerButton, homeImportRosterButton,
            visitingAddPlayerButton, visitingImportRosterButton,
        ];
        buttons.forEach((button) => {
            let modalId = button.id.split("Button")[0] + "Modal";
            button.addEventListener("click", function () {
                let modal = document.getElementById(modalId);
                let cancelButton = document.getElementsByName(modalId + "Cancel")[0];

                modal.style.display = "block";

                cancelButton.addEventListener("click", function () {
                    modal.style.display = "none";
                })
                // console.log(modal.id);
                // console.log(confirmButton.id);
                // console.log(cancelButton.id);
            })
        });

        // //Refresh Handled Timer
        // function startTimer(duration, display) {
        //     var timer = duration, minutes, seconds;
        //     setInterval(function () {
        //         minutes = parseInt(timer / 60, 10)
        //         seconds = parseInt(timer % 60, 10);

        //         minutes = minutes < 10 ? "0" + minutes : minutes;
        //         seconds = seconds < 10 ? "0" + seconds : seconds;

        //         display.textContent = `${minutes}:${seconds}` + "/60:00";
        //         if (++timer < 0) {
        //             timer = duration;
        //         }
        //         console.log(parseInt(seconds))
        //         window.localStorage.setItem("seconds", seconds)
        //         window.localStorage.setItem("minutes", minutes)
        //     }, 1000);
        // }

        // //onload - object has been loaded or created
        // window.onload = function () {
        //     sec = parseInt(window.localStorage.getItem("seconds"))
        //     min = parseInt(window.localStorage.getItem("minutes"))

        //     if (parseInt(min * sec)) {
        //         var sixtyMinutes = (parseInt(min * 60) + sec);
        //     } else {
        //         var sixtyMinutes = 60 * 60;
        //     }
        //     //var sixtyMinutes = 60 * 60;
        //     display = document.querySelector('#countdown');
        //     startTimer(sixtyMinutes, display);
        // };


        //EASY TIMER
               const startingTime = 0;
               let time = startingTime * 60;
               const countdownEl = document.getElementById('countdown');

               setInterval(updateCountdown, 1000);

               function updateCountdown(){
                   const minutes = Math.floor(time/60);
                   let seconds = time % 60;
                   seconds = seconds < 10 ? '0' + seconds:seconds;

                   countdownEl.innerHTML = `${minutes}:${seconds}` + "/60:00";
                   time++;
       }
    
    </script>
{% endblock %}