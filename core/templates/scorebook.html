{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load scorebook_extras %}

{% block title %}Scorebook{% endblock %}

{% block custom_css %}
    <style>
        div.scrollWrapper {
            height: 200px;
            width: 100%;
            overflow-y: scroll;
        }

        div.rosterScroll {
            height: 500px;
            width: 100%;
            overflow-y: scroll;
        }

        p {
            text-align: center;
            font-weight: bold;
            font-size: 30px;
            margin-top: 0;
        }

        tr:hover {
            background-color: #D6EEEE;
        }

    </style>
{% endblock custom_css %}

{% block content %}
    <div class="container-fluid">
    {#        <div class="row">#}
    {#            <div class="col-md-6">#}
    {#                {% if home_running_score_form.errors %}#}
    {#                {% for error in home_running_score_form.errors %}#}
    {#                    {{ error }}#}
    {#                {% endfor %}#}
    {#            {% endif %}#}
    {#            </div>#}
    {#        </div>#}

    <div class="row">
        <div class="col-md-5">
            <h1 class="bg_black">Game Information</h1>
            <ul class="list-group" style="font-size: 30px;">
                <li class="list-group-item"><b>Home
                    Team</b>: {{ scorebook.home_coach.roster.school }} {{ scorebook.home_coach.roster.team_name }}
                </li>
                <li class="list-group-item"><b>Visiting
                    Team</b>: {{ scorebook.visiting_coach.roster.school }} {{ scorebook.visiting_coach.roster.team_name }}
                </li>
                <li class="list-group-item"><b>Current Score</b>:
                    {% if scorebook.running_score.home.count > scorebook.running_score.visiting.count %}
                        <span style="color:green;">
                                        <b>{{ scorebook.running_score.home.count }}</b>
                                    </span>
                        ---
                        <span style="color:red;">
                                        <b>{{ scorebook.running_score.visiting.count }}</b>
                                    </span>
                    {% elif scorebook.running_score.home.count < scorebook.running_score.visiting.count %}
                        <span style="color:red;">
                                        <b>{{ scorebook.running_score.home.count }}</b>
                                    </span>
                        ---
                        <span style="color:green;">
                                        <b>{{ scorebook.running_score.visiting.count }}</b>
                                    </span>
                    {% else %}
                        <span style="color:orange;">
                                        <b>{{ scorebook.running_score.home.count }}</b>
                                    </span>
                        ---
                        <span style="color:orange;">
                                        <b>{{ scorebook.running_score.visiting.count }}</b>
                                    </span>
                    {% endif %}
                </li>
            </ul>
        </div>

        <div class="col-md-4">
            <h1 class="bg_black"><b>Game Timer</b></h1>
            <p><label id="minutes">00</label>:<label id="seconds">00</label>/60:00</p>
            <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Toolbar with button groups">
                <div class="btn-group mr-2" role="group" aria-label="First group">
                    <button id="startTimerButton" type="button" class="btn btn-success btn-lg" data-toggle="tooltip"
                            data-html="true" title="Start Timer" onclick="startTimer()">
                        <span class="glyphicon glyphicon-play"></span>
                    </button>
                    <button id="pauseTimerButton" type="button" class="btn btn-primary btn-lg" data-toggle="tooltip"
                            data-html="true" title="Pause Timer" onclick="pauseTimer()">
                        <span class="glyphicon glyphicon-pause"></span>
                    </button>
                    <button id="stopTimerButton" type="button" class="btn btn-danger btn-lg" data-toggle="tooltip"
                            data-html="true" title="Stop Timer" onclick="stopTimer()">
                        <span class="glyphicon glyphicon-stop"></span>
                    </button>
                </div>
                <div class="btn-group mr-2" role="group" aria-label="Second group">
                    <button id="incrementSecondsButton" name="timerAdjustButtons" value="5" type="button"
                            class="btn btn-secondary btn-lg"
                            data-toggle="tooltip" data-html="true" title="Add 5 Seconds">
                        <span class="glyphicon glyphicon-plus"></span> 5s
                    </button>
                    <button id="decrementSecondsButton" name="timerAdjustButtons" value="-5" type="button"
                            class="btn btn-secondary btn-lg"
                            data-toggle="tooltip" title="Subtract 5 Seconds">
                        <span class="glyphicon glyphicon-minus"></span> 5s
                    </button>
                </div>
                <div class="btn-group mr-2" role="group" aria-label="Second group">
                    <button id="incrementMinuteButton" name="timerAdjustButtons" value="60" type="button"
                            class="btn btn-secondary btn-lg"
                            data-toggle="tooltip"
                            data-html="true" title="Add 1 Minute">
                        <span class="glyphicon glyphicon-plus"></span> 1m
                    </button>
                    <button id="decrementMinuteButton" name="timerAdjustButtons" value="-60" type="button"
                            class="btn btn-secondary btn-lg"
                            data-toggle="tooltip"
                            title="Subtract 1 Minute">
                        <span class="glyphicon glyphicon-minus"></span> 1m
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <h1 class="bg_black">
                <button id="publishScorebookButton" type="button" class="btn btn-success btn-lg btn-block">Publish
                    Scorebook
                </button>
                <button id="clearScorebookButton" type="button" class="btn btn-danger btn-lg btn-block">&ensp;Clear
                    Scorebook&ensp;
                </button>
                <button id="gameStatsButton" type="button" class="btn btn-primary btn-lg btn-block">Game Statistics
                </button>
                <button id="runTimeModeButton" type="button" class="btn btn-secondary btn-lg btn-block">Run Time Mode
                </button>
            </h1>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h1 class="bg_black">
                    <b>Home Running Scores</b>
                    <button id="homeScoreButton" type="button" class="btn btn-success">Add Score</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Goal #</th>
                            <th>Assist #</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for score in scorebook.running_score.home.all %}
                            <tr>
                                <td>{{ score.time }}</td>
                                <td>{{ score.quarter }}</td>
                                <td>{{ score.goal_number }}</td>
                                <td>{{ score.assist_number }}</td>
                                <td>
                                    <a href="/edit-score/{{ score.id }}" class="btn btn-success btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Score">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a href="/delete-score/{{ score.id }}" class="btn btn-danger btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Delete Score">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-6">
                <h1 class="bg_black">
                    <b>Visiting Running Scores</b>
                    <button id="visitingScoreButton" type="button" class="btn btn-success">Add Score</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Goal #</th>
                            <th>Assist #</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for score in scorebook.running_score.visiting.all %}
                            <tr>
                                <td>{{ score.time }}</td>
                                <td>{{ score.quarter }}</td>
                                <td>{{ score.goal_number }}</td>
                                <td>{{ score.assist_number }}</td>
                                <td>
                                    <a href="/edit-score/{{ score.id }}" class="btn btn-success btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Score">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a href="/delete-score/{{ score.id }}" class="btn btn-danger btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Delete Score">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Penalties</b>
                    <span class="dropdown">
                        <button class="btn btn-danger dropdown-toggle" id="homeDropdownMenuButton" type="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Penalties
                        </button>
                        <span class="dropdown-menu" aria-labelledby=dropdownMenu1>
                            <li>
                                <button class="dropdown-item" id="homePersonalFoulButton" type="button">Personal Foul
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="homeTechnicalFoulButton" type="button">Technical
                                    Foul
                                </button>
                            </li>
                        </span>
                    </span>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>P/T</th>
                            <th>#</th>
                            <th>Infraction</th>
                            <th>Qtr</th>
                            <th>Time</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for penalty in scorebook.penalties.home.all %}
                            <tr>
                                {% if penalty.personal_foul == True %}
                                    <td>P</td>
                                {% else %}
                                    <td>T</td>
                                {% endif %}
                                <td>{{ penalty.player_number }}</td>
                                <td>{{ penalty.infraction }}</td>
                                <td>{{ penalty.quarter }}</td>
                                <td>{{ penalty.time }}</td>
                                <td>
                                    {% if penalty.personal_foul == True %}
                                        <a href="/edit-personal-foul/{{ penalty.id }}" class="btn btn-success btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Edit Personal Foul">
                                            <span class="glyphicon glyphicon-pencil"></span>
                                        </a>
                                        <a href="/delete-penalty/{{ penalty.id }}" class="btn btn-danger btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Delete Penalty">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>
                                    {% else %}
                                        <a href="/edit-technical-foul/{{ penalty.id }}" class="btn btn-success btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Edit Technical Foul">
                                            <span class="glyphicon glyphicon-pencil"></span>
                                        </a>
                                        <a href="/delete-penalty/{{ penalty.id }}" class="btn btn-danger btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Delete Penalty">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>


            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Timeouts</b>
                    <button id="homeTimeoutButton" type="button" class="btn btn-primary">Call Timeout</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for timeout in scorebook.timeouts.home.all %}
                            <tr>
                                <td>{{ timeout.time }}</td>
                                <td>{{ timeout.quarter }}</td>
                                <td>
                                    <a href="/edit-timeout/{{ timeout.id }}" class="btn btn-success btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Timeout">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a href="/delete-timeout/{{ timeout.id }}" class="btn btn-danger btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Timeout">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Penalties</b>
                    <span class="dropdown">
                        <button class="btn btn-danger dropdown-toggle" type="button" id="visitingDropdownMenuButton"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                            Penalize
                        </button>
                        <span class="dropdown-menu" aria-labelledby=dropdownMenu2>
                            <li>
                                <button class="dropdown-item" id="visitingPersonalFoulButton" type="button">Personal
                                    Foul
                                </button>
                            </li>
                            <li>
                                <button class="dropdown-item" id="visitingTechnicalFoulButton" type="button">Technical
                                    Foul
                                </button>
                            </li>
                        </span>
                    </span>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>P/T</th>
                            <th>#</th>
                            <th>Infraction</th>
                            <th>Qtr</th>
                            <th>Time</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for penalty in scorebook.penalties.visiting.all %}
                            <tr>
                                {% if penalty.personal_foul == True %}
                                    <td>P</td>
                                {% else %}
                                    <td>T</td>
                                {% endif %}
                                <td>{{ penalty.player_number }}</td>
                                <td>{{ penalty.infraction }}</td>
                                <td>{{ penalty.quarter }}</td>
                                <td>{{ penalty.time }}</td>
                                <td>
                                    {% if penalty.personal_foul == True %}
                                        <a href="/edit-personal-foul/{{ penalty.id }}" class="btn btn-success btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Edit Personal Foul">
                                            <span class="glyphicon glyphicon-pencil"></span>
                                        </a>
                                        <a href="/delete-penalty/{{ penalty.id }}" class="btn btn-danger btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Delete Penalty">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>
                                    {% else %}
                                        <a href="/edit-technical-foul/{{ penalty.id }}" class="btn btn-success btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Edit Technical Foul">
                                            <span class="glyphicon glyphicon-pencil"></span>
                                        </a>
                                        <a href="/delete-penalty/{{ penalty.id }}" class="btn btn-danger btn-sm"
                                           data-toggle="tooltip"
                                           data-html="true" title="Delete Penalty">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Timeouts</b>
                    <button id="visitingTimeoutButton" type="button" class="btn btn-primary">Call Timeout</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for timeout in scorebook.timeouts.visiting.all %}
                            <tr>
                                <td>{{ timeout.time }}</td>
                                <td>{{ timeout.quarter }}</td>
                                <td>
                                    <a href="/edit-timeout/{{ timeout.id }}" class="btn btn-success btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Timeout">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a href="/delete-timeout/{{ timeout.id }}" class="btn btn-danger btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Delete Timeout">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-9">
                <h1 class="bg_black">
                    <b>Home Roster</b>
                    <button id="homeAddPlayerButton" type="button" class="btn btn-success">Add Player</button>
                    <button id="homeImportLineupButton" type="button" class="btn btn-primary">Import Starting Lineup
                    </button>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Position</th>
                            <th>Name</th>
                            <th>Quarters</th>
                            <th>Shots</th>
                            <th>Goals</th>
                            <th>Assists</th>
                            <th>Ground Balls</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for player in scorebook.home_coach.roster.player_set.all %}
                            {# TODO: Update IDs for home/visiting roster checkboxes/text fields.#}
                            <tr name="homePlayer">
                                <td>{{ player.player_number }}</td>
                                <td>{{ player.position }}</td>
                                <td>{{ player.last_name }}, {{ player.first_name }}</td>
                                <td>
                                    <span class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox"
                                               value="{{ player.statistics.first_quarter }}"
                                               onclick="updatePlayerStatistics({{ player.id }}, 'homeQ1Input')"
                                               id="homeQ1Input{{ player.id }}">
                                        <label class="form-check-label" for="homeQ1Input{{ player.id }}">I</label>
                                    </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.second_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'homeQ2Input')"
                                                   id="homeQ2Input{{ player.id }}">
                                            <label class="form-check-label" for="homeQ2Input{{ player.id }}">II</label>
                                    </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.third_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'homeQ3Input')"
                                                   id="homeQ3Input{{ player.id }}">
                                            <label class="form-check-label" for="homeQ3Input{{ player.id }}">III</label>
                                    </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.fourth_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'homeQ4Input')"
                                                   id="homeQ4Input{{ player.id }}">
                                            <label class="form-check-label" for="homeQ4Input{{ player.id }}">IV</label>
                                    </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.overtime }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'homeOTInput')"
                                                   id="homeOTInput{{ player.id }}">
                                            <label class="form-check-label" for="homeOTInput{{ player.id }}">OT</label>
                                    </span>
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="homeShotsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'homeShotsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'homeShotsInput')"
                                           placeholder="0" value="{{ player.statistics.shots }}">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0" id="homeGoalsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'homeGoalsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'homeGoalsInput')"
                                           placeholder="0" value="{{ player.statistics.goals }}">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0"
                                           id="homeAssistsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'homeAssistsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'homeAssistsInput')"
                                           placeholder="0" value="{{ player.statistics.assists }}">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0"
                                           id="homeGroundBallsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'homeGroundBallsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'homeGroundBallsInput')"
                                           placeholder="0" value="{{ player.statistics.ground_balls }}">
                                </td>
                                <td>
                                    <a href="/edit-scorebook-player/{{ player.id }}" class="btn btn-success btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Player">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a href="/delete-scorebook-player/{{ player.id }}" class="btn btn-danger btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Delete Player">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Goalies & Saves</b>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Q1</th>
                            <th>Q2</th>
                            <th>Q3</th>
                            <th>Q4</th>
                            <th>OT</th>
                            <th>Total</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for player in scorebook.home_coach.roster.player_set.all %}
                            {% if "G" in player.position %}
                                <tr>
                                    <td>
                                        {{ player.player_number }}
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.first_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 0, 'homeGoalInput', true)"
                                               onkeyup="updateGoalTotals({{ player.id }}, 0, 'homeGoalInput', true)"
                                               id="homeGoalInput1_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.second_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 1, 'homeGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 1, 'homeGoalInput', true)"
                                               id="homeGoalInput2_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.third_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 2, 'homeGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 2, 'homeGoalInput', true)"
                                               id="homeGoalInput3_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.fourth_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 3, 'homeGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 3, 'homeGoalInput', true)"
                                               id="homeGoalInput4_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.overtime }}"
                                               onclick="updateGoalTotals({{ player.id }}, 4, 'homeGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 4, 'homeGoalInput', true)"
                                               id="homeGoalInputOT_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td name="homeGoalInput"><b>0</b></td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-9">
                <h1 class="bg_black">
                    <b>Visiting Roster</b>
                    <button id="visitingAddPlayerButton" type="button" class="btn btn-success">Add Player</button>
                    <button id="visitingImportLineupButton" type="button" class="btn btn-primary">Import Starting
                        Lineup
                    </button>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Position</th>
                            <th>Name</th>
                            <th>Quarters</th>
                            <th>Shots</th>
                            <th>Goals</th>
                            <th>Assists</th>
                            <th>Ground Balls</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for player in scorebook.visiting_coach.roster.player_set.all %}
                            <tr name="visitingPlayer">
                                <td>{{ player.player_number }}</td>
                                <td>{{ player.position }}</td>
                                <td>{{ player.last_name }}, {{ player.first_name }}</td>
                                <td>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.first_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'visitingQ1Input')"
                                                   id="visitingQ1Input{{ player.id }}">
                                            <label class="form-check-label"
                                                   for="visitingQ1Input{{ player.id }}">I</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.second_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'visitingQ2Input')"
                                                   id="visitingQ2Input{{ player.id }}">
                                            <label class="form-check-label"
                                                   for="visitingQ2Input{{ player.id }}">II</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.third_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'visitingQ3Input')"
                                                   id="visitingQ3Input{{ player.id }}">
                                            <label class="form-check-label"
                                                   for="visitingQ3Input{{ player.id }}">III</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.fourth_quarter }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'visitingQ4Input')"
                                                   id="visitingQ4Input{{ player.id }}">
                                            <label class="form-check-label"
                                                   for="visitingQ4Input{{ player.id }}">IV</label>
                                        </span>
                                    <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox"
                                                   value="{{ player.statistics.overtime }}"
                                                   onclick="updatePlayerStatistics({{ player.id }}, 'visitingOTInput')"
                                                   id="visitingOTInput{{ player.id }}">
                                            <label class="form-check-label"
                                                   for="visitingOTInput{{ player.id }}">OT</label>
                                        </span>
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0"
                                           id="visitingShotsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'visitingShotsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'visitingShotsInput')"
                                           placeholder="0" value="{{ player.statistics.shots }}">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0"
                                           id="visitingGoalsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'visitingGoalsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'visitingGoalsInput')"
                                           placeholder="0" value="{{ player.statistics.goals }}">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0"
                                           id="visitingAssistsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'visitingAssistsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'visitingAssistsInput')"
                                           placeholder="0" value="{{ player.statistics.assists }}">
                                </td>
                                <td>
                                    <input type="number" class="form-control" min="0"
                                           id="visitingGroundBallsInput{{ player.id }}"
                                           onkeyup="updatePlayerStatistics({{ player.id }}, 'visitingGroundBallsInput')"
                                           onclick="updatePlayerStatistics({{ player.id }}, 'visitingGroundBallsInput')"
                                           placeholder="0" value="{{ player.statistics.ground_balls }}">
                                </td>
                                <td>
                                    <a href="/edit-scorebook-player/{{ player.id }}" class="btn btn-success btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Edit Player">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    <a href="/delete-scorebook-player/{{ player.id }}" class="btn btn-danger btn-sm"
                                       data-toggle="tooltip"
                                       data-html="true" title="Delete Player">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Goalies & Saves</b>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Q1</th>
                            <th>Q2</th>
                            <th>Q3</th>
                            <th>Q4</th>
                            <th>OT</th>
                            <th>Total</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for player in scorebook.visiting_coach.roster.player_set.all %}
                            <tr>
                                {% if "G" in player.position %}
                                    <td>
                                        {{ player.player_number }}
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.first_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 0, 'visitingGoalInput', true)"
                                               onkeyup="updateGoalTotals({{ player.id }}, 0, 'visitingGoalInput', true)"
                                               id="visitingGoalInput1_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.second_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 1, 'visitingGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 1, 'visitingGoalInput', true)"
                                               id="visitingGoalInput2_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.third_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 2, 'visitingGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 2, 'visitingGoalInput', true)"
                                               id="visitingGoalInput3_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.fourth_quarter }}"
                                               onclick="updateGoalTotals({{ player.id }}, 3, 'visitingGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 3, 'visitingGoalInput', true)"
                                               id="visitingGoalInput4_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0"
                                               value="{{ player.saves.overtime }}"
                                               onclick="updateGoalTotals({{ player.id }}, 4, 'visitingGoalInput', true);"
                                               onkeyup="updateGoalTotals({{ player.id }}, 4, 'visitingGoalInput', true)"
                                               id="visitingGoalInputOT_{{ player.id }}" placeholder="0">
                                    </td>
                                    <td name="visitingGoalInput"><b>0</b></td>
                                    </tr>
                                {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <div id="publishScorebookModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Publish Scorebook</h1>
            <form action="" method="POST">
                {% csrf_token %}
                <p>Are you sure?</p>
                <input class="btn btn-primary btn-lg" type="submit" name="publishScorebookModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="publishScorebookModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="clearScorebookModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Clear Scorebook</h1>
            <form action="" method="POST">
                {% csrf_token %}
                <p>Are you sure?</p>
                <input class="btn btn-primary btn-lg" type="submit" name="clearScorebookModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="clearScorebookModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeScoreModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Score</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ home_running_score_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeScoreModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeScoreModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingScoreModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Score</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ visiting_running_score_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingScoreModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingScoreModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homePersonalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Personal Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ home_personal_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homePersonalFoulModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homePersonalFoulModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeTechnicalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Technical Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ home_technical_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTechnicalFoulModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTechnicalFoulModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingPersonalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Personal Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ visiting_personal_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingPersonalFoulModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingPersonalFoulModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingTechnicalFoulModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Technical Foul</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ visiting_technical_foul_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingTechnicalFoulModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingTechnicalFoulModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeTimeoutModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Call Timeout</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ home_timeout_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingTimeoutModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Call Timeout</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ visiting_timeout_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeAddPlayerModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ home_add_player_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeAddPlayerModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeAddPlayerModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingAddPlayerModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ visiting_add_player_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingAddPlayerModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingAddPlayerModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeImportLineupModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Import Starting Lineup</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ import_lineup_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeImportLineupModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeImportLineupModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingImportLineupModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Import Starting Lineup</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ import_lineup_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingImportLineupModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingImportLineupModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>

    <div id="gameStatsModal" class="modal">
        <div class="modal-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="bg_black"><b>Game Statistics</b></h1>

                        <div class="row">
                            <div class="col-md-6">
                                <h1 class="bg_black"><b>Home Stats</b></h1>
                                <div class="rosterScroll">
                                    <table class="table table-light table-striped table-bordered">
                                        <thead>
                                        <tr>
                                            <th>Ranking</th>
                                            <th>Name</th>
                                            <th>Player #</th>
                                            <th>Position</th>
                                            <th>Goals</th>
                                            <th>Assists</th>
                                            <th>Ground Balls</th>
                                        </tr>
                                        </thead>
                                        <tbody id="homeGameStatistics">
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h1 class="bg_black"><b>Visiting Stats</b></h1>
                                <div class="rosterScroll">
                                    <table class="table table-light table-striped table-bordered">
                                        <thead>
                                        <tr>
                                            <th>Ranking</th>
                                            <th>Name</th>
                                            <th>Player #</th>
                                            <th>Position</th>
                                            <th>Goals</th>
                                            <th>Assists</th>
                                            <th>Ground Balls</th>
                                        </tr>
                                        </thead>
                                        <tbody id="visitingGameStatistics">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <input class="btn btn-danger btn-lg" type="button" name="gameStatsModalCancel" value="Cancel">
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="errorMessages">
        {% if home_running_score_form.errors %}
            {% for field in home_running_score_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if visiting_running_score_form.errors %}
            {% for field in visiting_running_score_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if home_personal_foul_form.errors %}
            {% for field in home_personal_foul_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if home_technical_foul_form.errors %}
            {% for field in home_technical_foul_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if visiting_personal_foul_form.errors %}
            {% for field in visiting_personal_foul_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if visiting_technical_foul_form.errors %}
            {% for field in visiting_technical_foul_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if home_timeout_form.errors %}
            {% for field in home_timeout_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if visiting_timeout_form.errors %}
            {% for field in visiting_timeout_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if home_add_player_form.errors %}
            {% for field in home_add_player_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% if visiting_add_player_form.errors %}
            {% for field in visiting_add_player_form %}
                {% for error in field.errors %}
                    <p>{{ error|escape }}</p>
                {% endfor %}
            {% endfor %}
        {% endif %}

    </div>

    <label id="scorebookId" hidden>{{ scorebook.id }}</label>
    {% if scorebook.elapsed_time == None %}

        <div>YO</div>
    {% endif %}
    <label id="scorebookTime">{{ scorebook.elapsed_time }}</label>

{% endblock %}

{% block custom_js %}
    <script type="text/javascript">
        let totalSeconds = 0;
        let scorebookId = document.getElementById("scorebookId");
        let minutesLabel = document.getElementById("minutes");
        let secondsLabel = document.getElementById("seconds");

        function pad(time) {
            let timeString = time + "";
            if (timeString.length < 2) {
                return "0" + timeString;
            } else {
                return timeString;
            }
        }

        /* Initialize the page with JavaScript before loading it using jQuery ready event. */
        $(document).ready(function () {
            /* Ensure goal totals are updated correctly. */
            updateGoalTotals(null, null, null, false);

            /* Check all the quarter checkboxes if they're selected. */
            let checkboxes = Array.from(document.getElementsByClassName("form-check-input"));
            checkboxes.forEach((checkbox) => {
                checkbox.checked = checkbox.value === "True";
            })

            /* Check for any input errors. */
            let errorDiv = document.getElementById("errorMessages");
            let errors = Array.from(errorDiv.children);

            /* If there are errors, alert the user with their description and clear the error div. */
            if (errors.length > 0) {
                let alertMessage = "Input rejected due to the following errors: \n";
                errors.forEach((error) => {
                    alertMessage += error.innerHTML + "\n";
                })
                alert(alertMessage);
                errorDiv.innerHTML = "";
            }

            /* Get the time of the scorebook object. */
            //let scorebookTime = document.getElementById("scorebookTime");
            //.log(scorebookTime);
            if ("totalSeconds" in localStorage) {
                totalSeconds = parseInt(localStorage.getItem("totalSeconds"));
                secondsLabel.innerHTML = pad(totalSeconds % 60);
                minutesLabel.innerHTML = pad(Math.floor(totalSeconds / 60));
            }
        });

        /* Get publish/clear scorebook buttons. */
        let publishScorebookButton = document.getElementById("publishScorebookButton");
        let clearScorebookButton = document.getElementById("clearScorebookButton");

        /* Get running score buttons. */
        let homeScoreButton = document.getElementById("homeScoreButton");
        let visitingScoreButton = document.getElementById("visitingScoreButton");

        /* Get penalty buttons. */
        let homePersonalFoulButton = document.getElementById("homePersonalFoulButton");
        let homeTechnicalFoulButton = document.getElementById("homeTechnicalFoulButton");
        let visitingPersonalFoulButton = document.getElementById("visitingPersonalFoulButton");
        let visitingTechnicalFoulButton = document.getElementById("visitingTechnicalFoulButton");

        /* Get timeout buttons. */
        let homeTimeoutButton = document.getElementById("homeTimeoutButton");
        let visitingTimeoutButton = document.getElementById("visitingTimeoutButton");

        /* Get roster buttons. */
        let homeAddPlayerButton = document.getElementById("homeAddPlayerButton");
        let homeImportLineupButton = document.getElementById("homeImportLineupButton");
        let visitingAddPlayerButton = document.getElementById("visitingAddPlayerButton");
        let visitingImportLineupButton = document.getElementById("visitingImportLineupButton");

        /* Define gameStats Button. */
        let gameStatsButton = document.getElementById("gameStatsButton");

        /* Assign event handlers to all main view buttons to open corresponding modal. */
        let modalButtons = [
            publishScorebookButton, clearScorebookButton,
            homeScoreButton, visitingScoreButton,
            homePersonalFoulButton, homeTechnicalFoulButton,
            visitingPersonalFoulButton, visitingTechnicalFoulButton,
            homeTimeoutButton, visitingTimeoutButton,
            homeAddPlayerButton, homeImportLineupButton,
            visitingAddPlayerButton, visitingImportLineupButton,
            gameStatsButton,
        ];
        modalButtons.forEach((button) => {
            let modalId = button.id.split("Button")[0] + "Modal";
            button.addEventListener("click", function () {
                let modal = document.getElementById(modalId);
                let cancelButton = document.getElementsByName(modalId + "Cancel")[0];

                /* If the game statistics button is clicked, update the tables with the top three players. */
                if (modalId.includes("gameStats")) {
                    updateGameStatistics();
                }

                modal.style.display = "block";

                cancelButton.addEventListener("click", function () {
                    modal.style.display = "none";
                })
            })
        });

        function updateGameStatistics() {
            function sortPlayers(player1, player2) {
                let player1Goals = player1.children[5].children[0].value;
                let player2Goals = player2.children[5].children[0].value;
                let player1Assists = player1.children[6].children[0].value;
                let player2Assists = player2.children[6].children[0].value;
                let player1GroundBalls = player1.children[7].children[0].value;
                let player2GroundBalls = player2.children[7].children[0].value;

                return (player2Goals + 0.5 * player2Assists + 0.75 * player2GroundBalls) - (player1Goals + 0.5 * player1Assists + 0.75 * player1GroundBalls);
            }

            function getStatsBody(teamPlayers) {
                let teamStatsBody = "";
                teamPlayers.forEach((player, index) => {
                    let playerName = player.children[2].innerHTML;
                    let playerNumber = player.children[0].innerHTML;
                    let playerPosition = player.children[1].innerHTML;
                    let playerGoals = player.children[5].children[0].value;
                    let playerAssists = player.children[6].children[0].value;
                    let playerGroundBalls = player.children[7].children[0].value;

                    teamStatsBody += "<tr>" +
                        `<td>${index + 1}</td>` +
                        `<td>${playerName}</td>` +
                        `<td>${playerNumber}</td>` +
                        `<td>${playerPosition}</td>` +
                        `<td>${playerGoals}</td>` +
                        `<td>${playerAssists}</td>` +
                        `<td>${playerGroundBalls}</td>` +
                        "</tr>"
                })
                return teamStatsBody;
            }

            let homePlayers = Array.from(document.getElementsByName("homePlayer")).sort(sortPlayers);
            let visitingPlayers = Array.from(document.getElementsByName("visitingPlayer")).sort(sortPlayers);

            let homeStatsBody = document.getElementById("homeGameStatistics");
            homeStatsBody.innerHTML = getStatsBody(homePlayers);

            let visitingStatsBody = document.getElementById("visitingGameStatistics");
            visitingStatsBody.innerHTML = getStatsBody(visitingPlayers);
        }

        /* Add home goalies' totals. */
        function updateGoalTotals(playerId, quarter, goalInput, sendToServer) {
            let goalTotals;
            if (!sendToServer) {
                goalTotals = [
                    Array.from(document.getElementsByName("homeGoalInput")),
                    Array.from(document.getElementsByName("visitingGoalInput"))
                ].flat();
                console.log(goalTotals);
            } else {
                goalTotals = document.getElementsByName(goalInput);
            }
            let quarterGoalsSaved = [];
            goalTotals.forEach((total) => {
                let row = total.parentNode;
                let quarters = Array.from(row.children).slice(1, -1);
                let totalGoalsSaved = 0;
                quarters.forEach((quarter) => {
                    let goalsSaved = parseInt(quarter.children[0].value);
                    totalGoalsSaved += goalsSaved;
                    quarterGoalsSaved.push(goalsSaved);
                })
                total.innerHTML = "<b>" + totalGoalsSaved + "</b>";
            });

            /* Then update the goalie's new saves to the database. */
            if (sendToServer) {
                $.ajax({
                    url: "http://127.0.0.1:8000/update-stats/",
                    type: "GET",
                    data: {
                        "id": playerId,
                        "stat_type": "goalie_saves",
                        "stat": null,
                        "stat_value": null,
                        "quarter": quarter,
                        "saves_value": quarterGoalsSaved[quarter]
                    }
                }).done(function (response) {
                })
                    .fail(function () {
                        console.log("Error Occurred");
                    });
            }
        }

        /* Update the player's shots, goals, assists, or ground balls. */
        function updatePlayerStatistics(playerId, statistic) {
            let statisticInput = document.getElementById(statistic + playerId);
            let stat = "";
            if (statistic.includes("home")) {
                let homeStatistic = statistic.split("Input")[0];
                stat = homeStatistic.split("home")[1];
            } else if (statistic.includes("visiting")) {
                let visitingStatistic = statistic.split("Input")[0];
                stat = visitingStatistic.split("visiting")[1];
            }

            if (statisticInput.type === "checkbox") {
                value = statisticInput.checked;
            } else {
                value = statisticInput.value;
            }

            console.log(value);
            console.log(stat);

            $.ajax({
                url: "http://127.0.0.1:8000/update-stats/",
                type: "GET",
                data: {
                    "id": playerId,
                    "stat_type": "player_statistics",
                    "stat": stat,
                    "stat_value": value,
                    "quarter": null,
                    "saves_value": null
                }
            })
                .done(function (response) {
                })
                .fail(function () {
                    console.log("Error Occurred");
                });
        }


        /* Define the timer and handle its related events. */
        /* totalSeconds is defined above. */
        let timerId = null;

        function setTime() {
            ++totalSeconds;
            secondsLabel.innerHTML = pad(totalSeconds % 60);
            minutesLabel.innerHTML = pad(Math.floor(totalSeconds / 60));
        }

        function startTimer() {
            console.log("WORKING");
            if (!timerId) {
                timerId = setInterval(setTime, 1000);
            }
        }

        function pauseTimer() {
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
            }
        }

        function stopTimer() {
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
            }
            totalSeconds = 0;
            secondsLabel.innerHTML = "00";
            minutesLabel.innerHTML = "00";
        }

        /* Increment/Decrement buttons. */
        let adjustButtons = document.getElementsByName("timerAdjustButtons");
        adjustButtons.forEach((button) => {
            let adjustValue = parseInt(button.value);
            button.addEventListener("click", function () {
                if (totalSeconds + adjustValue >= 0) {
                    totalSeconds += adjustValue;
                    secondsLabel.innerHTML = pad(totalSeconds % 60);
                    minutesLabel.innerHTML = pad(Math.floor(totalSeconds / 60));
                }
                console.log(totalSeconds);
            })
        });

        let runTimeModeButton = document.getElementById("runTimeModeButton");

        runTimeModeButton.addEventListener("click", (function () {
            $.ajax({
                url: "http://127.0.0.1:8000/update-timer/",
                type: "GET",
                async: true,
                data: {
                    "id": scorebookId.innerHTML,
                    "seconds": totalSeconds
                }
            }).done(function (response) {
            })
                .fail(function () {
                    alert("Error Occurred");
                });
        }));

        $(window).on("beforeunload", (function () {
            localStorage.setItem("totalSeconds", totalSeconds);
            $.ajax({
                url: "http://127.0.0.1:8000/update-timer/",
                type: "POST",
                async: true,
                data: {
                    "id": scorebookId.innerHTML,
                    "seconds": totalSeconds
                }
            }).done(function (response) {
            })
                .fail(function () {
                    alert("Error Occurred");
                });
        }));


    </script>
{% endblock %}