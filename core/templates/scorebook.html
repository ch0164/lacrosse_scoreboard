{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Scorebook{% endblock %}

{% block custom_css %}
    <style>
        div.scrollWrapper {
            height: 200px;
            width: 100%;
            overflow-y: scroll;
        }

        div.rosterScroll {
            height: 500px;
            width: 100%;
            overflow-y: scroll;
        }
    </style>
{% endblock custom_css %}

{% block content %}
    <div class="container-fluid">
        <div class="row">
            <h1 class="bg_black">Scorebook</h1>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h1 class="bg_black">Metadata</h1>
            </div>
            <div class="col-md-3">
                <h1 class="bg_black">Timer</h1>
            </div>
            <div class="col-md-3">
                <h1 class="bg_black">
                    <button id="publishScorebookButton" type="button" class="btn btn-success btn-lg btn-block">Publish
                        Scorebook
                    </button>
                    <button id="clearScorebookButton" type="button" class="btn btn-danger btn-lg btn-block">&ensp;Clear
                        Scorebook&ensp;
                    </button>
                </h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h1 class="bg_black">
                    <b>Home Running Scores</b>
                    <button id="homeScoreButton" type="button" class="btn btn-success">Add Score</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Goal #</th>
                            <th>Assist #</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if running_score is not None %}
                            {% if running_score.home_score is not None %}
                                {% for score in running_score.home_score.all %}
                                    <tr>
                                        <td>{{ score.time }}</td>
                                        <td>{{ score.quarter }}</td>
                                        <td>{{ score.goal_number }}</td>
                                        <td>{{ score.assist_number }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-6">
                <h1 class="bg_black">
                    <b>Visiting Running Scores</b>
                    <button id="visitingScoreButton" type="button" class="btn btn-success">Add Score</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-striped table-light table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                            <th>Goal #</th>
                            <th>Assist #</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if running_score is not None %}
                            {% if running_score.visiting_score is not None %}
                                {% for score in running_score.visiting_score.all %}
                                    <tr>
                                        <td>{{ score.time }}</td>
                                        <td>{{ score.quarter }}</td>
                                        <td>{{ score.goal_number }}</td>
                                        <td>{{ score.assist_number }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Penalties</b>
                    <button id="homePenaltyButton" type="button" class="btn btn-danger">Penalize</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>P/T</th>
                            <th>#</th>
                            <th>Infraction</th>
                            <th>Qtr</th>
                            <th>Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Home Timeouts</b>
                    <button id="homeTimeoutButton" type="button" class="btn btn-primary">Call Timeout</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if timeouts is not None %}
                            {% if timeouts.home_timeouts is not None %}
                                {% for timeout in timeouts.home_timeouts.all %}
                                    <tr>
                                        <td>{{ timeout.time }}</td>
                                        <td>{{ timeout.quarter }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Penalties</b>
                    <button id="visitingPenaltyButton" type="button" class="btn btn-danger">Penalize</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-bordered table-striped">
                        <thead>
                        <tr>
                            <th>P/T</th>
                            <th>#</th>
                            <th>Infraction</th>
                            <th>Qtr</th>
                            <th>Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-3">
                <h1 class="bg_black">
                    <b>Visiting Timeouts</b>
                    <button id="visitingTimeoutButton" type="button" class="btn btn-primary">Call Timeout</button>
                </h1>
                <div class="scrollWrapper">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Time</th>
                            <th>Qtr</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if timeouts is not None %}
                            {% if timeouts.visiting_timeouts is not None %}
                                {% for timeout in timeouts.visiting_timeouts.all %}
                                    <tr>
                                        <td>{{ timeout.time }}</td>
                                        <td>{{ timeout.quarter }}</td>
                                    </tr>
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h1 class="bg_black">
                    <b>Home Roster</b>
                    <button id="homeAddPlayerButton" type="button" class="btn btn-success">Add Player</button>
                    <button id="homeImportRosterButton" type="button" class="btn btn-primary">Import Roster</button>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Position</th>
                            <th>Name</th>
                            <th>Quarters</th>
                            <th>Shots</th>
                            <th>Goals</th>
                            <th>Assists</th>
                            <th>Ground Balls</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if home_roster is not None %}
                            {% for player in home_roster.player_set.all %}
{#                                TODO: Update IDs for home/visiting roster checkboxes/text fields.#}
                                <tr>
                                    <td>{{ player.player_number }}</td>
                                    <td>{{ player.position }}</td>
                                    <td>{{ player.last_name }}, {{ player.first_name }}</td>
                                    <td>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterI{{ player.id }}">
                                            <label class="form-check-label" for="quarterI{{ player.id }}">I</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterII{{ player.id }}">
                                            <label class="form-check-label" for="quarterII{{ player.id }}">II</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIII{{ player.id }}">
                                            <label class="form-check-label" for="quarterIII{{ player.id }}">III</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIV{{ player.id }}">
                                            <label class="form-check-label" for="quarterIV{{ player.id }}">IV</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterOT{{ player.id }}">
                                            <label class="form-check-label" for="quarterOT{{ player.id }}">OT</label>
                                        </span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input1" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input2" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input3" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input4" placeholder="0">
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h1 class="bg_black">
                    <b>Visiting Roster</b>
                    <button id="visitingAddPlayerButton" type="button" class="btn btn-success">Add Player</button>
                    <button id="visitingImportRosterButton" type="button" class="btn btn-primary">Import Roster</button>
                </h1>
                <div class="rosterScroll">
                    <table class="table table-light table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Position</th>
                            <th>Name</th>
                            <th>Quarters</th>
                            <th>Shots</th>
                            <th>Goals</th>
                            <th>Assists</th>
                            <th>Ground Balls</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if visiting_roster is not None %}
                            {% for player in visiting_roster.player_set.all %}
                                <tr>
                                    <td>{{ player.player_number }}</td>
                                    <td>{{ player.position }}</td>
                                    <td>{{ player.last_name }}, {{ player.first_name }}</td>
                                    <td>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterI{{ player.id }}">
                                            <label class="form-check-label" for="quarterI{{ player.id }}">I</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterII{{ player.id }}">
                                            <label class="form-check-label" for="quarterII{{ player.id }}">II</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIII{{ player.id }}">
                                            <label class="form-check-label" for="quarterIII{{ player.id }}">III</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterIV{{ player.id }}">
                                            <label class="form-check-label" for="quarterIV{{ player.id }}">IV</label>
                                        </span>
                                        <span class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" value=""
                                                   id="quarterOT{{ player.id }}">
                                            <label class="form-check-label" for="quarterOT{{ player.id }}">OT</label>
                                        </span>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input1" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input2" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input3" placeholder="0">
                                    </td>
                                    <td>
                                        <input type="number" class="form-control" min="0" id="input4" placeholder="0">
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="publishScorebookModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Publish Scorebook</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {#            {{ form|crispy }}#}
                <input class="btn btn-primary btn-lg" type="submit" name="publishScorebookModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="publishScorebookModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="clearScorebookModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Clear Scorebook</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {#            {{ form|crispy }}#}
                <input class="btn btn-primary btn-lg" type="submit" name="clearScorebookModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="clearScorebookModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeScoreModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Score</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ running_score_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeScoreModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeScoreModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingScoreModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Score</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ running_score_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingScoreModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingScoreModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    {#    TODO: Handle events in this modal such that clicking one of the buttons below will#}
    {#    display a different form (Personal/Technical) as a modal#}
    <div id="homePenaltyModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Penalize Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ home_penalties_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingPenaltyModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Penalize Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ visiting_penalties_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeTimeoutModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Call Timeout</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ timeout_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingTimeoutModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Call Timeout</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ timeout_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingTimeoutModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingTimeoutModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeAddPlayerModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {#            {{ form|crispy }}#}
                <input class="btn btn-primary btn-lg" type="submit" name="homeAddPlayerModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeAddPlayerModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    {#    TODO: how to handle multiple POST requests in one page #}
    {#    if 'newsletter_sub' in request.POST:#}
    {#    # do subscribe#}
    {#elif 'newsletter_unsub' in request.POST:#}
    {#    # do unsubscribe#}

    <div id="visitingAddPlayerModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Add Player</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {#            {{ form|crispy }}#}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingAddPlayerModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingAddPlayerModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="homeImportRosterModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Import Roster</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ import_roster_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="homeImportRosterModalConfirm" value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="homeImportRosterModalCancel" value="Cancel">
            </form>
        </div>
    </div>

    <div id="visitingImportRosterModal" class="modal">
        <div class="modal-content">
            <h1 class="bg_black">Import Roster</h1>
            <form action="" method="POST">
                {% csrf_token %}
                {{ import_roster_form|crispy }}
                <input class="btn btn-primary btn-lg" type="submit" name="visitingImportRosterModalConfirm"
                       value="Confirm">
                <input class="btn btn-danger btn-lg" type="button" name="visitingImportRosterModalCancel"
                       value="Cancel">
            </form>
        </div>
    </div>


{% endblock %}

{% block custom_js %}
    <script type="text/javascript">

        /* Get publish/clear scorebook buttons. */
        let publishScorebookButton = document.getElementById("publishScorebookButton");
        let clearScorebookButton = document.getElementById("clearScorebookButton");

        /* Get running score buttons. */
        let homeScoreButton = document.getElementById("homeScoreButton");
        let visitingScoreButton = document.getElementById("visitingScoreButton");

        /* Get penalty buttons. */
        let homePenaltyButton = document.getElementById("homePenaltyButton");
        let visitingPenaltyButton = document.getElementById("visitingPenaltyButton");

        /* Get timeout buttons. */
        let homeTimeoutButton = document.getElementById("homeTimeoutButton");
        let visitingTimeoutButton = document.getElementById("visitingTimeoutButton");

        /* Get roster buttons. */
        let homeAddPlayerButton = document.getElementById("homeAddPlayerButton");
        let homeImportRosterButton = document.getElementById("homeImportRosterButton");
        let visitingAddPlayerButton = document.getElementById("visitingAddPlayerButton");
        let visitingImportRosterButton = document.getElementById("visitingImportRosterButton");

        /* Assign event handlers to all main view buttons to open corresponding modal. */
        let buttons = [
            publishScorebookButton, clearScorebookButton,
            homeScoreButton, visitingScoreButton,
            homePenaltyButton, visitingPenaltyButton,
            homeTimeoutButton, visitingTimeoutButton,
            homeAddPlayerButton, homeImportRosterButton,
            visitingAddPlayerButton, visitingImportRosterButton,
        ];
        buttons.forEach((button) => {
            let modalId = button.id.split("Button")[0] + "Modal";
            button.addEventListener("click", function () {
                let modal = document.getElementById(modalId);
                let cancelButton = document.getElementsByName(modalId + "Cancel")[0];

                modal.style.display = "block";

                cancelButton.addEventListener("click", function () {
                    modal.style.display = "none";
                })
                {#console.log(modal.id);#}
                {#console.log(confirmButton.id);#}
                {#console.log(cancelButton.id);#}
            })
        });

    </script>
{% endblock %}